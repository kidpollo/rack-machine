#
# <%= @node[:iptables_config] %>
#
# Generated by Chef
#

*raw
:PREROUTING ACCEPT [81827:55351554]
:OUTPUT ACCEPT [73608:78319168]
COMMIT

*nat
:PREROUTING ACCEPT [2464:183957]
:POSTROUTING ACCEPT [744:46627]
:OUTPUT ACCEPT [744:46627]
COMMIT

*mangle
:PREROUTING ACCEPT [81827:55351554]
:INPUT ACCEPT [81727:55317354]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [73608:78319168]
:POSTROUTING ACCEPT [73608:78319168]
COMMIT

*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [5:12348]
# ICMP ports, allow pings
-A INPUT -p icmp -m icmp --icmp-type 11 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 4 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 443 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 53 -j ACCEPT
<% if @node[:instance_role] == 'db_master' %>
<% @node[:app_hosts].each do |host| %>
-A INPUT -p tcp -m tcp -s <%= host %> --dport 3306 -j ACCEPT
-A INPUT -p tcp -m tcp -s <%= host %> --dport 27017 -j ACCEPT  
<% end %>
<% end %>
COMMIT
